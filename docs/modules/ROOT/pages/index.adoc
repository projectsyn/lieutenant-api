= Lieutenant API
info@vshn.ch
0.0.1
:toc: left
:numbered:
:toclevels: 3
:source-highlighter: highlightjs
:keywords: openapi, rest, Lieutenant API 
:specDir: 
:snippetDir: 
:generator-template: v1 2019-12-20
:info-url: https://vshn.ch
:app-name: Lieutenant API

[abstract]
.Abstract
Project Syn Management API


// markup not found, no include::{specDir}intro.adoc[opts=optional]


== Access


* *Bearer* Authentication 




== Endpoints


[.Bootstrapping]
=== Bootstrapping


[.installSteward]
==== installSteward
    
`GET /install/steward.json`

Returns the Steward JSON installation manifest

===== Description 

Autogenerated JSON containing all the needed parameters for having Steward up and running. It Iterates through all available Cluster objects to find the object matching the token in the field `spec.bootstrapToken.token`. It checks if the token is valid (fields `spec.bootstrapToken.valid` and field `spec.bootstrapToken.validUntil`). If valid delivers the JSON and sets the field `spec.bootstrapToken.valid` to `false`.


// markup not found, no include::{specDir}install/steward.json/GET/spec.adoc[opts=optional]



===== Parameters





====== Query Parameters

[cols="2,3,1,1,1"]
|===         
|Name| Description| Required| Default| Pattern

| token 
| Initial bootstrap token  
| - 
| null 
|  

|===         


===== Return Type


<<Object>>


===== Content Type

* application/json

===== Responses

.http response codes
[cols="2,3,1"]
|===         
| Code | Message | Datatype 


| 200
| Kubernetes manifests to install Steward, the cluster agent
|  <<Object>>


| 401
| Token invalid
|  <<>>


| 404
| Cluster not found
|  <<>>


| 0
| A default response with a reason.
|  <<Reason>>

|===         

===== Samples


// markup not found, no include::{snippetDir}install/steward.json/GET/http-request.adoc[opts=optional]


// markup not found, no include::{snippetDir}install/steward.json/GET/http-response.adoc[opts=optional]



// file not found, no * wiremock data link :install/steward.json/GET/GET.json[]


ifdef::internal-generation[]
===== Implementation

// markup not found, no include::{specDir}install/steward.json/GET/implementation.adoc[opts=optional]


endif::internal-generation[]


[.Cluster]
=== Cluster


[.createCluster]
==== createCluster
    
`POST /clusters`

Creates a new cluster

===== Description 

Create a cluster in the API. The ID is generated by the API (in the form `c-<adjective>-<noun>-<digits>` where all the words are lowercase, max 63 characters in total). It checks if the tenant exists before creating the object, otherwise fails. It generates the `Cluster` object and its `<GitRepoSpec>` and `bootstrapToken` values.


// markup not found, no include::{specDir}clusters/POST/spec.adoc[opts=optional]



===== Parameters


===== Body Parameter

[cols="2,3,1,1,1"]
|===         
|Name| Description| Required| Default| Pattern

| ClusterProperties 
| Create a new Cluster <<ClusterProperties>> 
| X 
|  
|  

|===         





===== Return Type

<<Cluster>>


===== Content Type

* application/json

===== Responses

.http response codes
[cols="2,3,1"]
|===         
| Code | Message | Datatype 


| 201
| Cluster created
|  <<Cluster>>


| 400
| Cluster can&#39;t be created
|  <<Reason>>


| 405
| Cluster already exists
|  <<>>


| 0
| A default response with a reason.
|  <<Reason>>

|===         

===== Samples


// markup not found, no include::{snippetDir}clusters/POST/http-request.adoc[opts=optional]


// markup not found, no include::{snippetDir}clusters/POST/http-response.adoc[opts=optional]



// file not found, no * wiremock data link :clusters/POST/POST.json[]


ifdef::internal-generation[]
===== Implementation

// markup not found, no include::{specDir}clusters/POST/implementation.adoc[opts=optional]


endif::internal-generation[]


[.deleteCluster]
==== deleteCluster
    
`DELETE /clusters/{clusterId}`

Deletes a cluster

===== Description 

Deletes a cluster


// markup not found, no include::{specDir}clusters/\{clusterId\}/DELETE/spec.adoc[opts=optional]



===== Parameters

====== Path Parameters

[cols="2,3,1,1,1"]
|===         
|Name| Description| Required| Default| Pattern

| clusterId 
| Distinct id of the cluster.  
| X 
| null 
|  

|===         






===== Return Type



-

===== Content Type

* application/json

===== Responses

.http response codes
[cols="2,3,1"]
|===         
| Code | Message | Datatype 


| 204
| Cluster deleted
|  <<>>


| 403
| Cluster deletion forbidden
|  <<Reason>>


| 0
| A default response with a reason.
|  <<Reason>>

|===         

===== Samples


// markup not found, no include::{snippetDir}clusters/\{clusterId\}/DELETE/http-request.adoc[opts=optional]


// markup not found, no include::{snippetDir}clusters/\{clusterId\}/DELETE/http-response.adoc[opts=optional]



// file not found, no * wiremock data link :clusters/{clusterId}/DELETE/DELETE.json[]


ifdef::internal-generation[]
===== Implementation

// markup not found, no include::{specDir}clusters/\{clusterId\}/DELETE/implementation.adoc[opts=optional]


endif::internal-generation[]


[.getCluster]
==== getCluster
    
`GET /clusters/{clusterId}`

Returns all values of a cluster

===== Description 

Returns all values of a cluster


// markup not found, no include::{specDir}clusters/\{clusterId\}/GET/spec.adoc[opts=optional]



===== Parameters

====== Path Parameters

[cols="2,3,1,1,1"]
|===         
|Name| Description| Required| Default| Pattern

| clusterId 
| Distinct id of the cluster.  
| X 
| null 
|  

|===         






===== Return Type

<<Cluster>>


===== Content Type

* application/json

===== Responses

.http response codes
[cols="2,3,1"]
|===         
| Code | Message | Datatype 


| 200
| Cluster found
|  <<Cluster>>


| 404
| A cluster with the specified id wasn&#39;t found.
|  <<>>


| 0
| A default response with a reason.
|  <<Reason>>

|===         

===== Samples


// markup not found, no include::{snippetDir}clusters/\{clusterId\}/GET/http-request.adoc[opts=optional]


// markup not found, no include::{snippetDir}clusters/\{clusterId\}/GET/http-response.adoc[opts=optional]



// file not found, no * wiremock data link :clusters/{clusterId}/GET/GET.json[]


ifdef::internal-generation[]
===== Implementation

// markup not found, no include::{specDir}clusters/\{clusterId\}/GET/implementation.adoc[opts=optional]


endif::internal-generation[]


[.listClusters]
==== listClusters
    
`GET /clusters`

Returns a list of clusters

===== Description 

List of clusters available in the API


// markup not found, no include::{specDir}clusters/GET/spec.adoc[opts=optional]



===== Parameters





====== Query Parameters

[cols="2,3,1,1,1"]
|===         
|Name| Description| Required| Default| Pattern

| tenant 
| Filter clusters by tenant id  
| - 
| null 
|  

|===         


===== Return Type

array[<<Cluster>>]


===== Content Type

* application/json

===== Responses

.http response codes
[cols="2,3,1"]
|===         
| Code | Message | Datatype 


| 200
| Cluster listing. Empty array if no tenants available.
| List[<<Cluster>>] 


| 0
| A default response with a reason.
|  <<Reason>>

|===         

===== Samples


// markup not found, no include::{snippetDir}clusters/GET/http-request.adoc[opts=optional]


// markup not found, no include::{snippetDir}clusters/GET/http-response.adoc[opts=optional]



// file not found, no * wiremock data link :clusters/GET/GET.json[]


ifdef::internal-generation[]
===== Implementation

// markup not found, no include::{specDir}clusters/GET/implementation.adoc[opts=optional]


endif::internal-generation[]


[.updateCluster]
==== updateCluster
    
`PATCH /clusters/{clusterId}`

Updates a cluster

===== Description 

Updates a cluster


// markup not found, no include::{specDir}clusters/\{clusterId\}/PATCH/spec.adoc[opts=optional]



===== Parameters

====== Path Parameters

[cols="2,3,1,1,1"]
|===         
|Name| Description| Required| Default| Pattern

| clusterId 
| Distinct id of the cluster.  
| X 
| null 
|  

|===         

===== Body Parameter

[cols="2,3,1,1,1"]
|===         
|Name| Description| Required| Default| Pattern

| ClusterProperties 
| Update cluster with properties to be changed (RFC 7396) <<ClusterProperties>> 
| X 
|  
|  

|===         





===== Return Type

<<Cluster>>


===== Content Type

* application/json

===== Responses

.http response codes
[cols="2,3,1"]
|===         
| Code | Message | Datatype 


| 200
| Cluster updated
|  <<Cluster>>


| 403
| Cluster update forbidden
|  <<Reason>>


| 0
| A default response with a reason.
|  <<Reason>>

|===         

===== Samples


// markup not found, no include::{snippetDir}clusters/\{clusterId\}/PATCH/http-request.adoc[opts=optional]


// markup not found, no include::{snippetDir}clusters/\{clusterId\}/PATCH/http-response.adoc[opts=optional]



// file not found, no * wiremock data link :clusters/{clusterId}/PATCH/PATCH.json[]


ifdef::internal-generation[]
===== Implementation

// markup not found, no include::{specDir}clusters/\{clusterId\}/PATCH/implementation.adoc[opts=optional]


endif::internal-generation[]


[.Inventory]
=== Inventory


[.queryInventory]
==== queryInventory
    
`GET /inventory`

Returns inventory data according to query

===== Description 

Search inventory data


// markup not found, no include::{specDir}inventory/GET/spec.adoc[opts=optional]



===== Parameters





====== Query Parameters

[cols="2,3,1,1,1"]
|===         
|Name| Description| Required| Default| Pattern

| q 
| InfluxQL query string  
| - 
| null 
|  

|===         


===== Return Type

<<Inventory>>


===== Content Type

* application/json

===== Responses

.http response codes
[cols="2,3,1"]
|===         
| Code | Message | Datatype 


| 200
| Query succeeded
|  <<Inventory>>


| 0
| A default response with a reason.
|  <<Reason>>

|===         

===== Samples


// markup not found, no include::{snippetDir}inventory/GET/http-request.adoc[opts=optional]


// markup not found, no include::{snippetDir}inventory/GET/http-response.adoc[opts=optional]



// file not found, no * wiremock data link :inventory/GET/GET.json[]


ifdef::internal-generation[]
===== Implementation

// markup not found, no include::{specDir}inventory/GET/implementation.adoc[opts=optional]


endif::internal-generation[]


[.updateInventory]
==== updateInventory
    
`POST /inventory`

Write inventory data

===== Description 

Write inventory data


// markup not found, no include::{specDir}inventory/POST/spec.adoc[opts=optional]



===== Parameters


===== Body Parameter

[cols="2,3,1,1,1"]
|===         
|Name| Description| Required| Default| Pattern

| Inventory 
| Inventory data of a cluster <<Inventory>> 
| X 
|  
|  

|===         





===== Return Type



-

===== Content Type

* application/json

===== Responses

.http response codes
[cols="2,3,1"]
|===         
| Code | Message | Datatype 


| 201
| Inventory data stored
|  <<>>


| 0
| A default response with a reason.
|  <<Reason>>

|===         

===== Samples


// markup not found, no include::{snippetDir}inventory/POST/http-request.adoc[opts=optional]


// markup not found, no include::{snippetDir}inventory/POST/http-response.adoc[opts=optional]



// file not found, no * wiremock data link :inventory/POST/POST.json[]


ifdef::internal-generation[]
===== Implementation

// markup not found, no include::{specDir}inventory/POST/implementation.adoc[opts=optional]


endif::internal-generation[]


[.System]
=== System


[.healthz]
==== healthz
    
`GET /healthz`

API health check

===== Description 

API health check


// markup not found, no include::{specDir}healthz/GET/spec.adoc[opts=optional]



===== Parameters







===== Return Type


<<String>>


===== Content Type

* text/plain
* application/json

===== Responses

.http response codes
[cols="2,3,1"]
|===         
| Code | Message | Datatype 


| 200
| All is fine
|  <<String>>


| 0
| A default response with a reason.
|  <<Reason>>

|===         

===== Samples


// markup not found, no include::{snippetDir}healthz/GET/http-request.adoc[opts=optional]


// markup not found, no include::{snippetDir}healthz/GET/http-response.adoc[opts=optional]



// file not found, no * wiremock data link :healthz/GET/GET.json[]


ifdef::internal-generation[]
===== Implementation

// markup not found, no include::{specDir}healthz/GET/implementation.adoc[opts=optional]


endif::internal-generation[]


[.Tenant]
=== Tenant


[.createTenant]
==== createTenant
    
`POST /tenants`

Creates a new tenant

===== Description 

Create a tenant in the API. The ID is generated by the API (in the form `t-<adjective>-<noun>-<digits>` where all the words are lowercase, max 63 characters in total). It generates the `Tenant` object in the configured namespace (usually the same namespace where the API runs). The customer config Git repository (the `<GitRepoSpec>`) is automatically generated based on default configuration or using the provided values. If `gitRepo` is already set on creation, no `<GitRepoSpec>` will be added.


// markup not found, no include::{specDir}tenants/POST/spec.adoc[opts=optional]



===== Parameters


===== Body Parameter

[cols="2,3,1,1,1"]
|===         
|Name| Description| Required| Default| Pattern

| TenantProperties 
| Create a new tenant <<TenantProperties>> 
| X 
|  
|  

|===         





===== Return Type

<<Tenant>>


===== Content Type

* application/json

===== Responses

.http response codes
[cols="2,3,1"]
|===         
| Code | Message | Datatype 


| 201
| Tenant created
|  <<Tenant>>


| 400
| Tenant can&#39;t be created
|  <<Reason>>


| 405
| Tenant already exists
|  <<>>


| 0
| A default response with a reason.
|  <<Reason>>

|===         

===== Samples


// markup not found, no include::{snippetDir}tenants/POST/http-request.adoc[opts=optional]


// markup not found, no include::{snippetDir}tenants/POST/http-response.adoc[opts=optional]



// file not found, no * wiremock data link :tenants/POST/POST.json[]


ifdef::internal-generation[]
===== Implementation

// markup not found, no include::{specDir}tenants/POST/implementation.adoc[opts=optional]


endif::internal-generation[]


[.deleteTenant]
==== deleteTenant
    
`DELETE /tenants/{tenantId}`

Deletes a tenant

===== Description 

Deletes a tenant


// markup not found, no include::{specDir}tenants/\{tenantId\}/DELETE/spec.adoc[opts=optional]



===== Parameters

====== Path Parameters

[cols="2,3,1,1,1"]
|===         
|Name| Description| Required| Default| Pattern

| tenantId 
| Distinct id of the tenant.  
| X 
| null 
|  

|===         






===== Return Type



-

===== Content Type

* application/json

===== Responses

.http response codes
[cols="2,3,1"]
|===         
| Code | Message | Datatype 


| 204
| Tenant deleted
|  <<>>


| 403
| Tenant deletion forbidden
|  <<Reason>>


| 0
| A default response with a reason.
|  <<Reason>>

|===         

===== Samples


// markup not found, no include::{snippetDir}tenants/\{tenantId\}/DELETE/http-request.adoc[opts=optional]


// markup not found, no include::{snippetDir}tenants/\{tenantId\}/DELETE/http-response.adoc[opts=optional]



// file not found, no * wiremock data link :tenants/{tenantId}/DELETE/DELETE.json[]


ifdef::internal-generation[]
===== Implementation

// markup not found, no include::{specDir}tenants/\{tenantId\}/DELETE/implementation.adoc[opts=optional]


endif::internal-generation[]


[.getTenant]
==== getTenant
    
`GET /tenants/{tenantId}`

Returns all values of a tenant

===== Description 

Returns all values of a tenant


// markup not found, no include::{specDir}tenants/\{tenantId\}/GET/spec.adoc[opts=optional]



===== Parameters

====== Path Parameters

[cols="2,3,1,1,1"]
|===         
|Name| Description| Required| Default| Pattern

| tenantId 
| Distinct id of the tenant.  
| X 
| null 
|  

|===         






===== Return Type

<<Tenant>>


===== Content Type

* application/json

===== Responses

.http response codes
[cols="2,3,1"]
|===         
| Code | Message | Datatype 


| 200
| Tenant found
|  <<Tenant>>


| 404
| A tenant with the specified id wasn&#39;t found.
|  <<>>


| 0
| A default response with a reason.
|  <<Reason>>

|===         

===== Samples


// markup not found, no include::{snippetDir}tenants/\{tenantId\}/GET/http-request.adoc[opts=optional]


// markup not found, no include::{snippetDir}tenants/\{tenantId\}/GET/http-response.adoc[opts=optional]



// file not found, no * wiremock data link :tenants/{tenantId}/GET/GET.json[]


ifdef::internal-generation[]
===== Implementation

// markup not found, no include::{specDir}tenants/\{tenantId\}/GET/implementation.adoc[opts=optional]


endif::internal-generation[]


[.listTenants]
==== listTenants
    
`GET /tenants`

Returns a list of tenants

===== Description 

List of all tenants available in the API


// markup not found, no include::{specDir}tenants/GET/spec.adoc[opts=optional]



===== Parameters







===== Return Type

array[<<Tenant>>]


===== Content Type

* application/json

===== Responses

.http response codes
[cols="2,3,1"]
|===         
| Code | Message | Datatype 


| 200
| Tenant listing. Empty array if no tenants available.
| List[<<Tenant>>] 


| 0
| A default response with a reason.
|  <<Reason>>

|===         

===== Samples


// markup not found, no include::{snippetDir}tenants/GET/http-request.adoc[opts=optional]


// markup not found, no include::{snippetDir}tenants/GET/http-response.adoc[opts=optional]



// file not found, no * wiremock data link :tenants/GET/GET.json[]


ifdef::internal-generation[]
===== Implementation

// markup not found, no include::{specDir}tenants/GET/implementation.adoc[opts=optional]


endif::internal-generation[]


[.updateTenant]
==== updateTenant
    
`PATCH /tenants/{tenantId}`

Updates a tenant

===== Description 

Updates a tenant


// markup not found, no include::{specDir}tenants/\{tenantId\}/PATCH/spec.adoc[opts=optional]



===== Parameters

====== Path Parameters

[cols="2,3,1,1,1"]
|===         
|Name| Description| Required| Default| Pattern

| tenantId 
| Distinct id of the tenant.  
| X 
| null 
|  

|===         

===== Body Parameter

[cols="2,3,1,1,1"]
|===         
|Name| Description| Required| Default| Pattern

| TenantProperties 
| Update tenant with properties to be changed (RFC 7396) <<TenantProperties>> 
| X 
|  
|  

|===         





===== Return Type

<<Tenant>>


===== Content Type

* application/json

===== Responses

.http response codes
[cols="2,3,1"]
|===         
| Code | Message | Datatype 


| 200
| Tenant updated
|  <<Tenant>>


| 403
| Tenant update forbidden
|  <<Reason>>


| 0
| A default response with a reason.
|  <<Reason>>

|===         

===== Samples


// markup not found, no include::{snippetDir}tenants/\{tenantId\}/PATCH/http-request.adoc[opts=optional]


// markup not found, no include::{snippetDir}tenants/\{tenantId\}/PATCH/http-response.adoc[opts=optional]



// file not found, no * wiremock data link :tenants/{tenantId}/PATCH/PATCH.json[]


ifdef::internal-generation[]
===== Implementation

// markup not found, no include::{specDir}tenants/\{tenantId\}/PATCH/implementation.adoc[opts=optional]


endif::internal-generation[]


[#models]
== Models


[#Cluster]
=== _Cluster_ 



[.fields-Cluster]
[cols="2,1,2,4,1"]
|===         
| Field Name| Required| Type| Description| Format

| id 
| X 
| String  
| A unique object identifier string. Automatically generated by the API on creation (in the form \&quot;&lt;letter&gt;-&lt;adjective&gt;-&lt;noun&gt;-&lt;digits&gt;\&quot; where all letters are lowercase, max 63 characters in total). 
|  

| displayName 
|  
| String  
| Display Name of the cluster
|  

| facts 
|  
| Object  
| Facts about a cluster object. Statically configured key/value pairs.
|  

| gitRepo 
|  
| GitRepo  
| 
|  

| tenant 
| X 
| String  
| Id of the tenant this cluster belongs to
|  

| installURL 
|  
| String  
| URL to fetch install manifests for Steward cluster agent. This will only be set if the cluster&#39;s token is still valid.
|  

|===


[#ClusterId]
=== _ClusterId_ 



[.fields-ClusterId]
[cols="2,1,2,4,1"]
|===         
| Field Name| Required| Type| Description| Format

| id 
| X 
| String  
| A unique object identifier string. Automatically generated by the API on creation (in the form \&quot;&lt;letter&gt;-&lt;adjective&gt;-&lt;noun&gt;-&lt;digits&gt;\&quot; where all letters are lowercase, max 63 characters in total). 
|  

|===


[#ClusterProperties]
=== _ClusterProperties_ 

A cluster defition object.
The Git repository is usually managed by the API and autogenerated.
The sshDeployKey will be managed by Steward

[.fields-ClusterProperties]
[cols="2,1,2,4,1"]
|===         
| Field Name| Required| Type| Description| Format

| displayName 
|  
| String  
| Display Name of the cluster
|  

| facts 
|  
| Object  
| Facts about a cluster object. Statically configured key/value pairs.
|  

| gitRepo 
|  
| GitRepo  
| 
|  

| tenant 
| X 
| String  
| Id of the tenant this cluster belongs to
|  

| installURL 
|  
| String  
| URL to fetch install manifests for Steward cluster agent. This will only be set if the cluster&#39;s token is still valid.
|  

|===


[#GitRepo]
=== _GitRepo_ 

Configuration Git repository, usually generated by the API

[.fields-GitRepo]
[cols="2,1,2,4,1"]
|===         
| Field Name| Required| Type| Description| Format

| url 
|  
| String  
| Full URL of the git repo
|  

| type 
|  
| String  
| Specifies if a repo should be managed by the git controller. A value of &#39;unmanaged&#39; means it&#39;s not manged by the controller
|  

| deployKey 
|  
| String  
| SSH public key / deploy key for clusterconfiguration catalog Git repository. This property is managed by Steward.
|  

| hostKeys 
|  
| String  
| SSH known hosts of the git server (multiline possible for multiple keys)
|  

|===


[#Inventory]
=== _Inventory_ 

Inventory data of a cluster

[.fields-Inventory]
[cols="2,1,2,4,1"]
|===         
| Field Name| Required| Type| Description| Format

| cluster 
| X 
| String  
| 
|  

| inventory 
|  
| Object  
| 
|  

|===


[#Reason]
=== _Reason_ 

A reason for responses

[.fields-Reason]
[cols="2,1,2,4,1"]
|===         
| Field Name| Required| Type| Description| Format

| reason 
| X 
| String  
| The reason message
|  

|===


[#Tenant]
=== _Tenant_ 



[.fields-Tenant]
[cols="2,1,2,4,1"]
|===         
| Field Name| Required| Type| Description| Format

| id 
| X 
| String  
| A unique object identifier string. Automatically generated by the API on creation (in the form \&quot;&lt;letter&gt;-&lt;adjective&gt;-&lt;noun&gt;-&lt;digits&gt;\&quot; where all letters are lowercase, max 63 characters in total). 
|  

| displayName 
|  
| String  
| Display name of the tenant
|  

| tenant 
|  
| String  
| The tenant this tenant belongs to
|  

| gitRepo 
|  
| GitRepo  
| 
|  

|===


[#TenantId]
=== _TenantId_ 



[.fields-TenantId]
[cols="2,1,2,4,1"]
|===         
| Field Name| Required| Type| Description| Format

| id 
| X 
| String  
| A unique object identifier string. Automatically generated by the API on creation (in the form \&quot;&lt;letter&gt;-&lt;adjective&gt;-&lt;noun&gt;-&lt;digits&gt;\&quot; where all letters are lowercase, max 63 characters in total). 
|  

|===


[#TenantProperties]
=== _TenantProperties_ 

A tenant defition object.
It can belong to another tenant to allow for tenant hierarchies.
The Git repository is usually managed by the API and autogenerated.
All properties except name are optional on creation.

[.fields-TenantProperties]
[cols="2,1,2,4,1"]
|===         
| Field Name| Required| Type| Description| Format

| displayName 
|  
| String  
| Display name of the tenant
|  

| tenant 
|  
| String  
| The tenant this tenant belongs to
|  

| gitRepo 
|  
| GitRepo  
| 
|  

|===


